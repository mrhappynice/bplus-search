<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SearXNG Direct</title>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.9.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <style>
        :root {
            --bg-color: #1a1a1a;
            --text-color: #e0e0e0;
            --container-bg: #2d2d2d;
            --border-color: #444;
            --primary-color: #64b5f6;
            --button-hover-bg: #42a5f5;
            --disabled-color: #555;
            --link-color: #90caf9;
            --code-bg: #3c3c3c;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
            line-height: 1.6;
            margin: 0;
            display: flex;
            flex-direction: column;
            min-height: 100vh;
            background-color: var(--bg-color);
            color: var(--text-color);
        }
        
        main {
            flex-grow: 1;
            max-width: 800px;
            margin: 20px auto;
            padding: 0 20px;
        }

        h1, h2 {
            color: var(--text-color);
        }

        .container {
            background-color: var(--container-bg);
            padding: 20px;
            border-radius: 8px;
            box-shadow: 0 4px 8px rgba(0,0,0,0.2);
            margin-bottom: 1.5rem;
        }

        #summary-content { white-space: pre-wrap; }
        #summary-content p, #summary-content ul, #summary-content ol, #summary-content h1, #summary-content h2, #summary-content h3 { margin-top: 0.5em; margin-bottom: 0.5em; }
        #summary-content code { background-color: var(--code-bg); padding: 2px 4px; border-radius: 4px; font-family: 'SFMono-Regular', Consolas, 'Liberation Mono', Menlo, Courier, monospace; }
        #summary-content pre { background-color: var(--code-bg); padding: 10px; border-radius: 4px; overflow-x: auto; margin-bottom: 1em; }
        #summary-content pre code { background: none; padding: 0; }

        .result { border-bottom: 1px solid var(--border-color); padding: 15px 0; }
        .result:last-child { border-bottom: none; }
        .result h3 { margin: 0 0 5px 0; color: var(--primary-color); }
        .result a { color: var(--link-color); text-decoration: none; font-size: 0.9em; }
        .result a:hover { text-decoration: underline; }
        .result p { margin: 5px 0 0 0; color: var(--text-color); }

        #status { text-align: center; color: var(--text-color); padding: 10px; }

        #search-footer {
            background-color: var(--container-bg);
            padding: 15px 20px;
            border-top: 1px solid var(--border-color);
            position: sticky;
            bottom: 0;
            width: 100%;
            box-sizing: border-box;
            margin-top: auto;
        }
        
        .footer-content {
            max-width: 800px;
            margin: 0 auto;
        }

        /* --- NEW STYLES FOR TIMEFRAME BUTTONS --- */
        #timeframe-buttons {
            display: flex;
            gap: 10px;
            margin-bottom: 10px;
            justify-content: center;
        }

        .timeframe-btn {
            background-color: #3d3d3d;
            color: var(--text-color);
            border: 1px solid var(--border-color);
            padding: 8px 12px;
            border-radius: 5px;
            cursor: pointer;
            transition: background-color 0.2s ease, border-color 0.2s ease;
        }

        .timeframe-btn:hover {
            background-color: #4f4f4f;
        }

        .timeframe-btn.active {
            background-color: var(--primary-color);
            border-color: var(--button-hover-bg);
            color: white;
        }
        /* --- END NEW STYLES --- */

        #search-form {
            display: flex;
            gap: 10px;
        }

        #query-input {
            flex-grow: 1; padding: 12px; font-size: 16px; border: 1px solid var(--border-color); border-radius: 5px; background-color: #3d3d3d; color: var(--text-color); outline: none;
        }
        #query-input::placeholder { color: #bbb; }

        #search-button {
            padding: 12px 20px; font-size: 16px; background-color: var(--primary-color); color: white; border: none; border-radius: 5px; cursor: pointer; transition: background-color 0.2s ease;
        }
        #search-button:hover:not(:disabled) { background-color: var(--button-hover-bg); }
        #search-button:disabled { background-color: var(--disabled-color); cursor: not-allowed; }
    </style>
</head>
<body>

    <main>
        <h1>SearXNG Direct Interface</h1>
        <div id="summary-container" class="container" style="display: none;">
            <h2>Summary</h2>
            <div id="summary-content"></div>
        </div>
        <div id="results-container" class="container" style="display: none;">
            <h2>Detailed Results</h2>
            <div id="results-list"></div>
        </div>
        <div id="status"></div>
    </main>

    <footer id="search-footer">
        <!-- Move form and buttons into a container div -->
        <div class="footer-content">
            <!-- START NEW HTML FOR BUTTONS -->
            <div id="timeframe-buttons">
                <button class="timeframe-btn" data-timeframe="day">Past 24 hours</button>
                <button class="timeframe-btn" data-timeframe="week">Past week</button>
                <button class="timeframe-btn" data-timeframe="month">Past month</button>
                <button class="timeframe-btn active" data-timeframe="">All time</button>
            </div>
            <!-- END NEW HTML -->
            <form id="search-form">
                <input type="text" id="query-input" placeholder="Enter your search query..." required autocomplete="off">
                <button type="submit" id="search-button">Search</button>
            </form>
        </div>
    </footer>

    <script>
        const form = document.getElementById('search-form');
        const queryInput = document.getElementById('query-input');
        const searchButton = document.getElementById('search-button');
        const summaryContainer = document.getElementById('summary-container');
        const summaryContent = document.getElementById('summary-content');
        const resultsContainer = document.getElementById('results-container');
        const resultsList = document.getElementById('results-list');
        const statusDiv = document.getElementById('status');
        
        // --- NEW JAVASCRIPT FOR BUTTONS ---
        const timeframeButtonsContainer = document.getElementById('timeframe-buttons');
        let selectedTimeframe = ''; // Default to 'All time'

        timeframeButtonsContainer.addEventListener('click', (e) => {
            if (e.target.tagName === 'BUTTON') {
                // Remove 'active' class from all buttons
                timeframeButtonsContainer.querySelectorAll('.timeframe-btn').forEach(btn => {
                    btn.classList.remove('active');
                });
                // Add 'active' to the clicked button
                e.target.classList.add('active');
                // Update the selected timeframe
                selectedTimeframe = e.target.dataset.timeframe;
            }
        });
        // --- END NEW JAVASCRIPT ---

        marked.setOptions({ gfm: true, breaks: true, highlight: function(code, lang) { const language = hljs.getLanguage(lang) ? lang : 'plaintext'; return hljs.highlight(code, { language }).value; } });

        form.addEventListener('submit', async (e) => {
            e.preventDefault();
            const query = queryInput.value;
            if (!query) return;

            let fullSummaryText = '';
            searchButton.disabled = true;
            statusDiv.textContent = 'Searching...';
            resultsList.innerHTML = '';
            summaryContent.innerHTML = '';
            resultsContainer.style.display = 'none';
            summaryContainer.style.display = 'none';

            try {
                // --- MODIFIED FETCH: Add timeframe to the body ---
                const response = await fetch('/search', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ query: query, timeframe: selectedTimeframe }) // Send timeframe
                });

                if (!response.ok || !response.body) { throw new Error('Network response was not ok.'); }

                const reader = response.body.getReader();
                const decoder = new TextDecoder();
                let buffer = '';

                while (true) {
                    const { done, value } = await reader.read();
                    if (done) break;

                    buffer += decoder.decode(value, { stream: true });
                    const lines = buffer.split('\n\n');
                    buffer = lines.pop(); 

                    for (const line of lines) {
                        if (line.startsWith('event:')) {
                            const eventType = line.match(/event: (.*)/)[1];
                            const data = JSON.parse(line.match(/data: (.*)/)[1]);
                            
                            if (eventType === 'summary-start') {
                                summaryContainer.style.display = 'block';
                            } else if (eventType === 'summary-chunk') {
                                fullSummaryText += data.text;
                                summaryContent.innerHTML = marked.parse(fullSummaryText);
                            } else {
                                handleEvent(eventType, data);
                            }
                        }
                    }
                }
            } catch (error) {
                console.error('Fetch Error:', error);
                statusDiv.textContent = `Error: ${error.message}`;
            } finally {
                searchButton.disabled = false;
                statusDiv.textContent = '';
                hljs.highlightAll();
            }
        });

        function handleEvent(type, data) {
            if (type === 'result') {
                resultsContainer.style.display = 'block';
                const resultDiv = document.createElement('div');
                resultDiv.className = 'result';
                resultDiv.innerHTML = `<h3>${data.title}</h3><p>${data.content}</p><a href="${data.url}" target="_blank" rel="noopener noreferrer">${data.url}</a>`;
                resultsList.appendChild(resultDiv);
            } else if (type === 'error') {
                statusDiv.textContent = `An error occurred on the server: ${data.message}`;
            }
        }
    </script>
</body>
</html>